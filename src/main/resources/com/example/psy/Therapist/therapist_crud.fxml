<?xml version="1.0" encoding="UTF-8"?>

<?import java.lang.String?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.FlowPane?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.shape.Circle?>

<StackPane prefHeight="650.0" prefWidth="1100.0" styleClass="background-gradient" stylesheets="@../style.css"
           xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="Controllers.Therapists.TherapistCRUDController">
    <children>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             MAIN CONTENT
             â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <VBox spacing="18.0">
            <padding><Insets bottom="28.0" left="28.0" right="28.0" top="28.0" /></padding>
            <children>

                <!-- HEADER -->
                <HBox alignment="CENTER_LEFT" spacing="20.0"
                      style="-fx-background-color: white; -fx-background-radius: 14; -fx-padding: 18 24 18 24; -fx-effect: dropshadow(three-pass-box, rgba(111,78,55,0.08), 10, 0, 0, 0); -fx-border-color: #f0e6d6; -fx-border-width: 1; -fx-border-radius: 14;">
                    <children>
                        <VBox>
                            <children>
                                <Label styleClass="section-title" text="Gestion des MÃ©decins" />
                                <Label fx:id="totalTherapistsLabel" style="-fx-font-size: 13px; -fx-text-fill: #8a6a55;" text="0 mÃ©decin enregistrÃ©" />
                            </children>
                        </VBox>
                        <Region HBox.hgrow="ALWAYS" />
                        <Button mnemonicParsing="false" fx:id="dispo" onAction="#handleSwitch" styleClass="btn-secondary" text="DisponibilitÃ©s âžœ" />
                        <Button mnemonicParsing="false" fx:id="ajoutdocteur" onAction="#openAddModal" styleClass="btn-primary" text="+ Ajouter un mÃ©decin" />
                    </children>
                </HBox>

                <!-- SEARCH & FILTER BAR -->
                <HBox alignment="CENTER_LEFT" spacing="12.0"
                      style="-fx-background-color: white; -fx-background-radius: 12; -fx-padding: 14 20 14 20; -fx-effect: dropshadow(three-pass-box, rgba(111,78,55,0.06), 8, 0, 0, 0); -fx-border-color: #f0e6d6; -fx-border-width: 1; -fx-border-radius: 12;">
                    <children>
                        <!-- Search icon -->
                        <Label text="ðŸ”" style="-fx-font-size: 16px;" />

                        <!-- Name search -->
                        <TextField fx:id="searchField"
                                   promptText="Rechercher par nom ou prÃ©nom..."
                                   style="-fx-background-color: #fdf7f0; -fx-background-radius: 8; -fx-border-color: #d2b48c; -fx-border-radius: 8; -fx-padding: 8 12 8 12; -fx-font-size: 13px;"
                                   prefWidth="280.0" />

                        <!-- Divider -->
                        <Label text="|" style="-fx-text-fill: #d2b48c; -fx-font-size: 18px;" />

                        <!-- Speciality filter -->
                        <Label text="ðŸŽ“ SpÃ©cialitÃ© :" style="-fx-font-weight: bold; -fx-font-size: 12px; -fx-text-fill: #6f4e37;" />
                        <ComboBox fx:id="specialityFilterBox" promptText="Toutes" prefWidth="190.0"
                                  style="-fx-background-color: #fdf7f0; -fx-background-radius: 8; -fx-border-color: #d2b48c; -fx-border-radius: 8; -fx-font-size: 12px;" />

                        <!-- Divider -->
                        <Label text="|" style="-fx-text-fill: #d2b48c; -fx-font-size: 18px;" />

                        <!-- Consultation type filter -->
                        <Label text="ðŸ¥ Mode :" style="-fx-font-weight: bold; -fx-font-size: 12px; -fx-text-fill: #6f4e37;" />
                        <ComboBox fx:id="consultTypeFilterBox" promptText="Tous modes" prefWidth="180.0"
                                  style="-fx-background-color: #fdf7f0; -fx-background-radius: 8; -fx-border-color: #d2b48c; -fx-border-radius: 8; -fx-font-size: 12px;" />

                        <Region HBox.hgrow="ALWAYS" />

                        <!-- Reset button -->
                        <Button fx:id="resetFilterBtn" mnemonicParsing="false" onAction="#resetFilters"
                                text="âœ• RÃ©initialiser"
                                style="-fx-background-color: #f5efe6; -fx-text-fill: #6f4e37; -fx-background-radius: 8; -fx-padding: 8 14 8 14; -fx-font-size: 12px; -fx-cursor: hand; -fx-border-color: #d2b48c; -fx-border-radius: 8;" />

                        <!-- Results count -->
                        <Label fx:id="searchResultLabel" text="" style="-fx-text-fill: #8a6a55; -fx-font-size: 12px;" />
                    </children>
                </HBox>

                <!-- CARDS -->
                <ScrollPane fitToWidth="true" hbarPolicy="NEVER" style="-fx-background-color: transparent; -fx-background: transparent;" VBox.vgrow="ALWAYS">
                    <content>
                        <VBox>
                            <children>
                                <Label fx:id="emptyStateLabel"
                                       text="Aucun thÃ©rapeute ne correspond Ã  votre recherche."
                                       visible="false" managed="false"
                                       style="-fx-font-size: 14px; -fx-text-fill: #b0927a; -fx-padding: 40;" />
                                <FlowPane fx:id="cardsContainer" hgap="22.0" vgap="22.0" prefWrapLength="1000.0" style="-fx-padding: 5;" />
                            </children>
                        </VBox>
                    </content>
                </ScrollPane>

            </children>
        </VBox>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             PROFILE DETAIL MODAL
             â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <StackPane fx:id="profileModalOverlay" alignment="CENTER"
                   style="-fx-background-color: rgba(62,44,35,0.55);" visible="false">
            <children>
                <VBox maxWidth="680.0" spacing="0"
                      style="-fx-background-color: white; -fx-background-radius: 18; -fx-effect: dropshadow(gaussian, rgba(62,44,35,0.3), 35, 0, 0, 0);"
                      StackPane.alignment="CENTER">

                    <!-- Header banner â€” brown gradient -->
                    <VBox alignment="BOTTOM_LEFT" prefHeight="130.0"
                          style="-fx-background-color: linear-gradient(to right, #6f4e37, #8a6a55); -fx-background-radius: 18 18 0 0; -fx-padding: 22 28 18 28;">
                        <children>
                            <HBox alignment="CENTER_LEFT" spacing="18.0">
                                <children>
                                    <!-- Avatar initials circle -->
                                    <StackPane prefHeight="70.0" prefWidth="70.0"
                                               style="-fx-background-color: rgba(255,255,255,0.22); -fx-background-radius: 50; -fx-border-color: rgba(255,255,255,0.55); -fx-border-width: 2; -fx-border-radius: 50;">
                                        <children>
                                            <Label fx:id="profileInitialsLabel" text="AB"
                                                   style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: white;" />
                                        </children>
                                    </StackPane>
                                    <VBox spacing="5.0">
                                        <children>
                                            <Label fx:id="profileNameLabel" text="Dr. Nom PrÃ©nom"
                                                   style="-fx-font-size: 21px; -fx-font-weight: bold; -fx-text-fill: white;" />
                                            <!-- Speciality pill -->
                                            <Label fx:id="profileSpecLabel" text="SpÃ©cialitÃ©"
                                                   style="-fx-font-size: 12px; -fx-text-fill: rgba(255,255,255,0.9); -fx-background-color: rgba(255,255,255,0.18); -fx-background-radius: 20; -fx-padding: 3 12 3 12;" />
                                        </children>
                                    </VBox>
                                    <Region HBox.hgrow="ALWAYS" />
                                    <!-- Close X -->
                                    <Button mnemonicParsing="false" onAction="#closeProfileModal"
                                            style="-fx-background-color: rgba(255,255,255,0.18); -fx-text-fill: white; -fx-font-size: 15px; -fx-background-radius: 50; -fx-cursor: hand; -fx-min-width: 32; -fx-min-height: 32; -fx-padding: 0;"
                                            text="âœ•" />
                                </children>
                            </HBox>
                        </children>
                    </VBox>

                    <!-- Status strip â€” military green accent -->
                    <HBox alignment="CENTER_LEFT" spacing="10.0"
                          style="-fx-background-color: #fdfaf5; -fx-padding: 10 28 10 28; -fx-border-color: #f0e6d6; -fx-border-width: 0 0 1 0;">
                        <children>
                            <Label fx:id="profileStatusBadge" text="â— ACTIF"
                                   style="-fx-font-size: 11px; -fx-font-weight: bold; -fx-text-fill: #3d7a5a; -fx-background-color: #e8f5ed; -fx-background-radius: 20; -fx-padding: 4 12 4 12;" />
                            <Label fx:id="profileConsultTypeLabel" text="Consultation"
                                   style="-fx-font-size: 11px; -fx-text-fill: #6f4e37; -fx-background-color: #f5efe6; -fx-background-radius: 20; -fx-padding: 4 12 4 12; -fx-border-color: #d2b48c; -fx-border-radius: 20; -fx-border-width: 1;" />
                            <Region HBox.hgrow="ALWAYS" />
                            <Label fx:id="profileMemberSinceLabel" text=""
                                   style="-fx-font-size: 11px; -fx-text-fill: #a08060;" />
                        </children>
                    </HBox>

                    <!-- Info grid -->
                    <VBox spacing="14.0" style="-fx-padding: 22 28 22 28;">
                        <children>
                            <!-- Email + Phone -->
                            <HBox spacing="16.0">
                                <children>
                                    <VBox spacing="4.0" HBox.hgrow="ALWAYS">
                                        <children>
                                            <Label text="ðŸ“§  Email" style="-fx-font-size: 10px; -fx-font-weight: bold; -fx-text-fill: #a08060;" />
                                            <Label fx:id="profileEmailLabel" text="â€”"
                                                   style="-fx-font-size: 13px; -fx-text-fill: #3e2c23; -fx-background-color: #fdf7f0; -fx-background-radius: 7; -fx-padding: 8 11 8 11; -fx-border-color: #e8d5bc; -fx-border-radius: 7; -fx-border-width: 1;"
                                                   maxWidth="Infinity" />
                                        </children>
                                    </VBox>
                                    <VBox spacing="4.0" HBox.hgrow="ALWAYS">
                                        <children>
                                            <Label text="ðŸ“ž  TÃ©lÃ©phone" style="-fx-font-size: 10px; -fx-font-weight: bold; -fx-text-fill: #a08060;" />
                                            <Label fx:id="profilePhoneLabel" text="â€”"
                                                   style="-fx-font-size: 13px; -fx-text-fill: #3e2c23; -fx-background-color: #fdf7f0; -fx-background-radius: 7; -fx-padding: 8 11 8 11; -fx-border-color: #e8d5bc; -fx-border-radius: 7; -fx-border-width: 1;"
                                                   maxWidth="Infinity" />
                                        </children>
                                    </VBox>
                                </children>
                            </HBox>

                            <!-- Specialization -->
                            <VBox spacing="4.0">
                                <children>
                                    <Label text="ðŸŽ“  SpÃ©cialisation" style="-fx-font-size: 10px; -fx-font-weight: bold; -fx-text-fill: #a08060;" />
                                    <Label fx:id="profileSpecFullLabel" text="â€”"
                                           style="-fx-font-size: 13px; -fx-text-fill: #3e2c23; -fx-background-color: #fdf7f0; -fx-background-radius: 7; -fx-padding: 8 11 8 11; -fx-border-color: #e8d5bc; -fx-border-radius: 7; -fx-border-width: 1;"
                                           wrapText="true" maxWidth="Infinity" />
                                </children>
                            </VBox>

                            <!-- Description -->
                            <VBox spacing="4.0">
                                <children>
                                    <Label text="ðŸ“  Ã€ propos" style="-fx-font-size: 10px; -fx-font-weight: bold; -fx-text-fill: #a08060;" />
                                    <Label fx:id="profileDescLabel" text="â€”"
                                           style="-fx-font-size: 13px; -fx-text-fill: #5a3e2b; -fx-background-color: #fdf7f0; -fx-background-radius: 7; -fx-padding: 12; -fx-border-color: #e8d5bc; -fx-border-radius: 7; -fx-border-width: 1; -fx-line-spacing: 3;"
                                           wrapText="true" maxWidth="Infinity" />
                                </children>
                            </VBox>
                        </children>
                    </VBox>

                    <!-- Footer -->
                    <HBox alignment="CENTER" spacing="12.0"
                          style="-fx-background-color: #fdf7f0; -fx-background-radius: 0 0 18 18; -fx-border-color: #e8d5bc; -fx-border-width: 1 0 0 0; -fx-padding: 18 28 18 28;">
                        <children>
                            <Button mnemonicParsing="false" onAction="#closeProfileModal"
                                    style="-fx-background-color: white; -fx-text-fill: #6f4e37; -fx-background-radius: 9; -fx-padding: 11 22 11 22; -fx-font-size: 13px; -fx-cursor: hand; -fx-border-color: #d2b48c; -fx-border-radius: 9; -fx-border-width: 1;"
                                    text="Fermer" />
                            <Region HBox.hgrow="ALWAYS" />
                            <!-- RDV button â€” military green -->
                            <Button fx:id="rdvButton" mnemonicParsing="false" onAction="#goToAppointment"
                                    style="-fx-background-color: linear-gradient(to right, #4a7c59, #5c8f6f); -fx-text-fill: white; -fx-font-weight: bold; -fx-background-radius: 9; -fx-padding: 11 26 11 26; -fx-font-size: 13px; -fx-cursor: hand; -fx-effect: dropshadow(gaussian, rgba(74,124,89,0.35), 10, 0, 0, 4);"
                                    text="ðŸ“…  Prendre un Rendez-vous" />
                        </children>
                    </HBox>

                </VBox>
            </children>
        </StackPane>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             ADD / EDIT MODAL
             â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <StackPane fx:id="modalOverlay" alignment="CENTER"
                   style="-fx-background-color: rgba(62,44,35,0.45);" visible="false">
            <children>
                <VBox maxWidth="600.0" spacing="20.0"
                      style="-fx-background-color: white; -fx-background-radius: 15; -fx-padding: 30; -fx-effect: dropshadow(gaussian, rgba(111,78,55,0.25), 22, 0, 0, 0);">
                    <children>
                        <HBox alignment="CENTER_LEFT">
                            <children>
                                <Label fx:id="modalTitle" styleClass="section-title" style="-fx-font-size: 19px;" text="Ajouter un mÃ©decin" />
                                <Region HBox.hgrow="ALWAYS" />
                                <Button mnemonicParsing="false" onAction="#closeModal"
                                        style="-fx-background-color: transparent; -fx-font-weight: bold; -fx-font-size: 17px; -fx-cursor: hand; -fx-text-fill: #a08060;" text="âœ•" />
                            </children>
                        </HBox>
                        <GridPane hgap="15.0" vgap="15.0">
                            <columnConstraints>
                                <ColumnConstraints hgrow="SOMETIMES" percentWidth="50.0" />
                                <ColumnConstraints hgrow="SOMETIMES" percentWidth="50.0" />
                            </columnConstraints>
                            <VBox spacing="5.0" GridPane.columnIndex="0" GridPane.rowIndex="0">
                                <Label style="-fx-font-weight: bold; -fx-text-fill: #4e342e;" text="Nom *" />
                                <TextField fx:id="lastNameField" styleClass="form-control" promptText="Nom" />
                            </VBox>
                            <VBox spacing="5.0" GridPane.columnIndex="1" GridPane.rowIndex="0">
                                <Label style="-fx-font-weight: bold; -fx-text-fill: #4e342e;" text="PrÃ©nom *" />
                                <TextField fx:id="firstNameField" styleClass="form-control" promptText="PrÃ©nom" />
                            </VBox>
                            <VBox spacing="5.0" GridPane.columnIndex="0" GridPane.rowIndex="1">
                                <Label style="-fx-font-weight: bold; -fx-text-fill: #4e342e;" text="SpÃ©cialitÃ© *" />
                                <TextField fx:id="specializationField" styleClass="form-control" promptText="Ex: Psychologue" />
                            </VBox>
                            <VBox spacing="5.0" GridPane.columnIndex="1" GridPane.rowIndex="1">
                                <Label style="-fx-font-weight: bold; -fx-text-fill: #4e342e;" text="Type Consultation" />
                                <ComboBox fx:id="consultationTypeBox" maxWidth="Infinity" styleClass="form-control" promptText="SÃ©lectionner" />
                            </VBox>
                            <VBox spacing="5.0" GridPane.columnIndex="0" GridPane.rowIndex="2">
                                <Label style="-fx-font-weight: bold; -fx-text-fill: #4e342e;" text="Email *" />
                                <TextField fx:id="emailField" styleClass="form-control" promptText="email@example.com" />
                            </VBox>
                            <VBox spacing="5.0" GridPane.columnIndex="1" GridPane.rowIndex="2">
                                <Label style="-fx-font-weight: bold; -fx-text-fill: #4e342e;" text="TÃ©lÃ©phone *" />
                                <TextField fx:id="phoneField" styleClass="form-control" promptText="2XXXXXXX" />
                            </VBox>
                            <VBox spacing="5.0" GridPane.columnSpan="2" GridPane.rowIndex="3">
                                <Label style="-fx-font-weight: bold; -fx-text-fill: #4e342e;" text="Mot de Passe *" />
                                <TextField fx:id="passwordField" styleClass="form-control" promptText="Mot de passe" />
                            </VBox>
                            <VBox spacing="5.0" GridPane.columnSpan="2" GridPane.rowIndex="4">
                                <Label style="-fx-font-weight: bold; -fx-text-fill: #4e342e;" text="ðŸ–¼ Photo (URL)" />
                                <HBox spacing="8.0" alignment="CENTER_LEFT">
                                    <TextField fx:id="photoUrlField" styleClass="form-control" promptText="https://example.com/photo.jpg" HBox.hgrow="ALWAYS" />
                                    <!-- Preview thumbnail -->
                                    <StackPane prefWidth="50.0" prefHeight="50.0"
                                               style="-fx-background-color: #f5efe6; -fx-background-radius: 50; -fx-border-color: #d2b48c; -fx-border-radius: 50; -fx-border-width: 1;">
                                        <ImageView fx:id="photoPreview" fitWidth="48.0" fitHeight="48.0"
                                                   preserveRatio="false" smooth="true">
                                            <clip>
                                                <Circle centerX="24.0" centerY="24.0" radius="24.0"
                                                        xmlns="http://javafx.com/javafx/17"/>
                                            </clip>
                                        </ImageView>
                                        <Label fx:id="photoPreviewInitials" text="?" style="-fx-font-size:16px; -fx-text-fill:#a08060;" />
                                    </StackPane>
                                </HBox>
                            </VBox>
                            <VBox spacing="5.0" GridPane.columnSpan="2" GridPane.rowIndex="5">
                                <Label style="-fx-font-weight: bold; -fx-text-fill: #4e342e;" text="Description" />
                                <TextArea fx:id="descriptionArea" prefHeight="70.0" styleClass="form-control" wrapText="true" promptText="BrÃ¨ve description..." />
                            </VBox>
                        </GridPane>
                        <HBox alignment="CENTER_RIGHT" spacing="10.0">
                            <Button mnemonicParsing="false" onAction="#closeModal" styleClass="btn-secondary" text="Annuler" />
                            <Button mnemonicParsing="false" onAction="#handleSave" styleClass="btn-primary" text="Enregistrer" />
                        </HBox>
                    </children>
                </VBox>
            </children>
        </StackPane>

    </children>
</StackPane>
